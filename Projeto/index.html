<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Givanotacoes</title>
    <link rel="stylesheet" href="CSS/style.css" type="text/css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
</head>

<body>
    <nav class="p-3 bg-light d-flex justify-content-between align-items-center">
        <a class="logo text-center fw-bold fs-4">Givanotacoes</a>

        <div class="dropdown text-center">
            <button class="btn btn-success dropdown-toggle" type="button" data-bs-toggle="dropdown"
                aria-expanded="false">
                Criar
            </button>
            <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="#" onclick="criarBloco(); return false;">Bloco de notas</a></li>
                <li><a class="dropdown-item" href="#" onclick="abrirModal('postit'); return false;">Post-it</a></li>
                <li><a class="dropdown-item" href="#" onclick="abrirModal('categoria'); return false;">Criar</a></li>
                        categoria</a></li>

            </ul>
        </div>
    </nav>

    <div class="container text-center shadow-lg rounded-4 mt-5 p-4">
        <button type="button" class="btn btn-warning mb-3" onclick="salvarTudo()">Salvar Tudo</button>
        <button class="btn btn-info mb-3 ms-2" onclick="carregarTudo()">Carregar Tudo</button>
        <div class="dropdown d-inline">
            <button class="btn btn-danger dropdown-toggle mb-3 ms-2" type="button" id="dropdownDeletar"
                data-bs-toggle="dropdown" aria-expanded="false">
                Deletar
            </button>
            <ul class="dropdown-menu" aria-labelledby="dropdownDeletar">
                <li><a class="dropdown-item" href="#" onclick="DeletarTudo(); return false;">Deletar Tudo</a></li>
                <li><a class="dropdown-item" href="#" onclick="ativarModoSelecao(); return false;">Selecionar Itens</a>
                </li>
            </ul>
        </div>

        <!-- Botão oculto para confirmar exclusão dos selecionados -->
        <button id="btnConfirmarSelecao" class="btn btn-outline-danger mb-3 ms-2" style="display:none;"
            onclick="deletarSelecionados()">Deletar Selecionados</button>


        <!-- Área onde os blocos vão aparecer -->
        <div id="area-blocos" class="mt-4 d-flex flex-wrap gap-3 justify-content-center">
        </div>
    </div>
    <div class="container text-center shadow-lg rounded-4 mt-5 p-4">
        <div id="area-categoria" class="mt-4 d-flex flex-wrap gap-3 justify-content-center">
            <!--Area onde as categorias irão aparecer-->
        </div>
    </div>

    <div class="modal fade" id="modalPersonalizar" tabindex="-1" aria-labelledby="modalPersonalizarLabel"
        aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalPersonalizarLabel">Personalizar</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="tituloInput" class="form-label">Título</label>
                        <input type="text" class="form-control" id="tituloInput" placeholder="Digite o título">
                    </div>
                    <div class="mb-3">
                        <label for="corInput" class="form-label">Cor de Fundo</label>
                        <input type="color" class="form-control form-control-color" id="corInput" value="#ffeb3b">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="btnCriarItem">Criar</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let tipoAtual = '';

        function criarBloco(valor = '') {
            const area = document.getElementById('area-blocos');
            const bloco = document.createElement('textarea');
            bloco.className = 'bloco form-control';
            bloco.placeholder = 'Digite aqui...';
            bloco.style.width = '300px';
            bloco.style.height = '200px';
            bloco.value = valor;
            bloco.draggable = true;
            bloco.id = 'bloco-' + Date.now();

            bloco.addEventListener('dragstart', e => {
                e.dataTransfer.setData('id', bloco.id);
            });

            area.appendChild(bloco);
        }


        function criarCategoria(titulo = 'Nova Categoria', cor = 'red') {
            const area = document.getElementById('area-categoria');
            const cat = document.createElement('div');
            cat.className = 'categoria';
            cat.contentEditable = 'true';
            cat.textContent = titulo;
            cat.style.width = '300px';
            cat.style.height = '200px';
            cat.style.backgroundColor = cor;
            cat.style.padding = '10px';
            cat.style.border = '1px solid #ccc';
            cat.style.borderRadius = '8px';
            cat.style.boxShadow = '2px 2px 5px rgba(0,0,0,0.3)';
            cat.style.overflow = 'auto';
            cat.dataset.nome = titulo; // importante: nome interno da categoria

            // Permitir soltar itens dentro
            cat.addEventListener('dragover', e => e.preventDefault());
            cat.addEventListener('drop', e => {
                e.preventDefault();
                const id = e.dataTransfer.getData('id');
                const item = document.getElementById(id);
                if (item) {
                    cat.appendChild(item);
                    item.setAttribute('data-categoria', titulo);
                    cat.classList.add('tem-conteudo');
                }
            });

            // Tornar clicável se tiver conteúdo
            cat.addEventListener('click', () => {
                if (cat.classList.contains('tem-conteudo')) {
                    abrirCategoria(cat);
                }
            });

            area.appendChild(cat);
        }


        function criarPostIt(titulo = 'Novo Post-it', cor = 'yellow') {
            const area = document.getElementById('area-blocos');
            const postIt = document.createElement('div');
            postIt.className = 'postit';
            postIt.contentEditable = 'true';
            postIt.textContent = titulo;
            postIt.style.width = '150px';
            postIt.style.height = '150px';
            postIt.style.backgroundColor = cor;
            postIt.style.padding = '10px';
            postIt.style.border = '1px solid #ccc';
            postIt.style.borderRadius = '8px';
            postIt.style.boxShadow = '2px 2px 5px rgba(0,0,0,0.3)';
            postIt.style.overflow = 'auto';
            postIt.draggable = true;

            // ID único
            postIt.id = 'postit-' + Date.now();

            postIt.addEventListener('dragstart', e => {
                e.dataTransfer.setData('id', postIt.id);
            });

            area.appendChild(postIt);
        }


        function abrirModal(tipo) {
            tipoAtual = tipo;
            document.getElementById('tituloInput').value = '';
            document.getElementById('corInput').value = tipo === 'categoria' ? '#ff0000' : '#ffff00';
            document.getElementById('modalPersonalizarLabel').textContent =
                tipo === 'categoria' ? 'Criar Categoria' : 'Criar Post-it';

            const modal = new bootstrap.Modal(document.getElementById('modalPersonalizar'));
            modal.show();

            // Armazena o modal em variável global para fechar depois
            window.modalAtivo = modal;
        }


        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('btnCriarItem').addEventListener('click', () => {
                const titulo = document.getElementById('tituloInput').value ||
                    (tipoAtual === 'categoria' ? 'Nova Categoria' : 'Novo Post-it');
                const cor = document.getElementById('corInput').value;

                if (tipoAtual === 'categoria') criarCategoria(titulo, cor);
                else if (tipoAtual === 'postit') criarPostIt(titulo, cor);

                if (window.modalAtivo) window.modalAtivo.hide();
            });
        });

        function salvarTudo() {
            const blocos = [];
            document.querySelectorAll('.bloco').forEach(el => {
                blocos.push({ tipo: 'bloco', conteudo: el.value });
            });
            document.querySelectorAll('.postit').forEach(el => {
                blocos.push({ tipo: 'postit', conteudo: el.textContent, cor: el.style.backgroundColor });
            });
            document.querySelectorAll('.categoria').forEach(el => {
                blocos.push({ tipo: 'categoria', conteudo: el.textContent, cor: el.style.backgroundColor });
            });

            if (blocos.length === 0) {
                alert('Não há nada para salvar!');
                return;
            }

            localStorage.setItem('blocos', JSON.stringify(blocos));
            alert('Tudo foi salvo localmente!');
        }

        function carregarTudo() {
            const areaBlocos = document.getElementById('area-blocos');
            const areaCat = document.getElementById('area-categoria');
            areaBlocos.innerHTML = '';
            areaCat.innerHTML = '';

            const dados = JSON.parse(localStorage.getItem('blocos')) || [];
            dados.forEach(item => {
                if (item.tipo === 'bloco') criarBloco(item.conteudo, item.cor);
                if (item.tipo === 'postit') criarPostIt(item.conteudo, item.cor);
                if (item.tipo === 'categoria') criarCategoria(item.conteudo, item.cor);
            });

            if (dados.length === 0) alert('Não há dados salvos!');
        }

        function DeletarTudo() {

            const dados = JSON.parse(localStorage.getItem('blocos')) || [];

            // Se não houver dados, mostra o alerta e sai da função
            if (dados.length === 0) {
                alert('Não há dados para deletar!');
                return;
            }
            // Exibe confirmação
            const confirmar = confirm("Tem certeza que deseja deletar tudo? Essa ação não pode ser desfeita.");

            if (!confirmar) return; // Se cancelar, não faz nada

            // Limpa as áreas visuais
            document.getElementById('area-blocos').innerHTML = '';
            document.getElementById('area-categoria').innerHTML = '';
            // Remove os dados salvos
            localStorage.removeItem('blocos'); // apaga só os blocos

            // Mostra uma mensagem opcional
            alert('Todos os blocos, post-its e categorias foram deletados!');

            if (dados.length === 0) alert('Não há dados para deletar !');
        }

        let modoSelecao = false;

        function ativarModoSelecao() {
            modoSelecao = !modoSelecao;
            const todosItens = document.querySelectorAll('.bloco, .postit, .categoria');

            todosItens.forEach(item => {
                if (modoSelecao) {
                    item.style.cursor = 'pointer';
                    item.addEventListener('click', toggleSelecionado);
                } else {
                    item.style.cursor = 'default';
                    item.removeEventListener('click', toggleSelecionado);
                    item.classList.remove('selecionado');
                }
            });

            document.getElementById('btnConfirmarSelecao').style.display = modoSelecao ? 'inline-block' : 'none';

            alert(modoSelecao
                ? 'Modo de seleção ativado! Clique nos itens que deseja deletar.'
                : 'Modo de seleção desativado.');
        }

        function toggleSelecionado(event) {
            event.currentTarget.classList.toggle('selecionado');
        }

        function deletarSelecionados() {
            const selecionados = document.querySelectorAll('.selecionado');
            if (selecionados.length === 0) {
                alert('Nenhum item selecionado!');
                return;
            }

            if (!confirm('Tem certeza que deseja deletar os itens selecionados?')) return;

            // Remove os itens da tela
            selecionados.forEach(el => el.remove());

            // Atualiza localStorage, removendo os itens deletados
            const dados = JSON.parse(localStorage.getItem('blocos')) || [];
            const novosDados = dados.filter(item => {
                return ![...selecionados].some(sel => sel.textContent === item.conteudo);
            });

            localStorage.setItem('blocos', JSON.stringify(novosDados));

            document.getElementById('btnConfirmarSelecao').style.display = 'none';
            modoSelecao = false;

            alert('Itens selecionados foram deletados!');
        }

        function abrirCategoria(cat) {
            const titulo = cat.dataset.nome;
            const conteudo = Array.from(cat.querySelectorAll('.bloco, .postit'));

            if (conteudo.length === 0) {
                alert('Essa categoria está vazia!');
                return;
            }

            // Esconde áreas principais
            document.querySelector('.container').style.display = 'none';
            document.querySelector('#area-categoria').style.display = 'none';

            // Cria uma área temporária para mostrar os itens
            const areaTemp = document.createElement('div');
            areaTemp.id = 'area-temp';
            areaTemp.className = 'container mt-5 text-center';
            areaTemp.innerHTML = `
        <h3>${titulo}</h3>  <button class="btn btn-secondary mb-3" onclick="voltarPrincipal()">Voltar</button><div class="d-flex flex-wrap gap-3 justify-content-center"></div>`;

            document.body.appendChild(areaTemp);

            const areaConteudo = areaTemp.querySelector('div');
            conteudo.forEach(item => areaConteudo.appendChild(item));
        }

        function voltarPrincipal() {
            const temp = document.getElementById('area-temp');
            if (!temp) return;

            // Recoloca os elementos na área principal
            const itens = temp.querySelectorAll('.bloco, .postit');
            itens.forEach(item => {
                const categoria = item.getAttribute('data-categoria');
                if (categoria) {
                    const cat = [...document.querySelectorAll('.categoria')]
                        .find(c => c.dataset.nome === categoria);
                    if (cat) cat.appendChild(item);
                } else {
                    document.getElementById('area-blocos').appendChild(item);
                }
            });

            temp.remove();

            document.querySelector('.container').style.display = '';
            document.querySelector('#area-categoria').style.display = '';
        }



    </script>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
        crossorigin="anonymous"></script>
</body>

</html>